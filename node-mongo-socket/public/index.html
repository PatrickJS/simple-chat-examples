<!DOCTYPE html>
<html>
<head>
  <title>simple chat client</title>
  <link href='http://fonts.googleapis.com/css?family=Lato:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>

  <div class="chat">
    <input type="text" class="chat-name" placeholder="Enter your name">
    <div class="chat-messages">
    </div>
    <textarea placeholder="Type your message"></textarea>
    <div class="chat-status">Status: <span>Idle</span></div>
  </div>

  <script type="text/javascript" src="http://127.0.0.1:8080/socket.io/socket.io.js"></script>
  <script type="text/javascript">
    !function(document, $$, undefined) {

      $$ = $$ || function(s) {
        return document.querySelector(s)
      };

      var textarea = $$('.chat textarea');
      var chatName = $$('.chat-name');

      var config = {
        socket: {
          url: 'http://127.0.0.1:8080'
        }
      };

      try {
        var socket = io.connect(config.socket.url);
      } catch(err) {
        // set status to warn user
      }

      if (socket) {
        console.log('has socket');
        // listen for keydown
        textarea.addEventListener('keydown', function(event) {
          var name = chatName.value
          var message = this.value;

          console.log(event.which);
          if (event.which === 13 && !event.shiftKey) {

            console.log('Send!');

            socket.emit('input', {
              name: name,
              message: message
            });

          }
        });

      } else {
        console.log('undefined socket');
      }

    }(document, window.$$);
  </script>
</body>
</html>
